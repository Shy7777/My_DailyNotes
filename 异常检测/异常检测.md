fate4037!@7
chenshunda@genomics.cn
fate4037!@7
读论文，做算法，看机网

# A Multimodal Knowledge-enhanced Whole-slide Pathology Foundation Model


# 机网论文：

DeepSpace: Super Resolution Powered Efficient and Reliable Satellite Image Data Acquistion
太空遥感专家混合模型

SCX: Stateless KV-Cache Encoding for Cloud-Scale Confidential Transformer Serving
基于transformer

备份区：
The adjusted rand index was employed to assess the agreement between a clustering algorithm’s output partitions and gold-standard annotated label sets. It is an adjustment of the rand index, intended to account for coincidental cluster agreements that arise purely by random chance. This index ranges from 0 to 1, where 0 corresponds to cluster assignments equivalent to random labeling and 1 represents a perfect match between the two partition structures.

Adjusted rand index was used to measure agreement of the output partitions by a clustering algorithm with gold-standard annotated label sets. It is an adjustment of rand index for the coincidental cluster agreement that arises purely by chance.It ranges from 0 to 1, for which 0 means that the two cluster assignments are identical to random labeling and 1 means that the two types of partition results are identical to each other.

本文采用调整后的兰德指数来评估聚类算法的输出分区与黄金标准标注标签集之间的一致性。它是兰德指数的调整版本，旨在消除纯粹由随机因素造成的偶然聚类一致性。该指数的值范围在0到1之间，其中 0 表示聚类的分配结果与随机标注的结果相同，1 表示两种分区结构完全匹配。

调整后的兰德指数用于衡量聚类算法输出的分区与金标准标注标签集之间的一致性。它是兰德指数的一种调整，用于消除纯粹由偶然产生的聚类一致性。其取值范围在 0 到 1 之间，其中 0 表示两个聚类分配与随机标记相同，1 表示两种分区结果完全一致。

备份区：
To measure the alignment between ground-truth cell type annotations and Louvain cluster labels generated from integrated cell embeddings, we calculated the normalized mutual information (NMI) metric. Louvain clustering was performed over a resolution spectrum from 0.1 to 2, using 0.1 as the step interval, and the top-performing score across these configurations was selected for analysis. The NMI score corresponding to cell type matching is denoted as \(\text{NMI}_{\text{cell}}\); it spans 0 to 1, with higher values signifying a stronger correspondence between the cluster assignments and the true cell type identities.

To measure the alignment between ground-truth cell type annotations and Louvain cluster labels generated from integrated cell embeddings，we calculated a mutual information measure—normalized mutual information (NMI). Louvain clustering was performed over a resolution spectrum from 0.1 to 2 at step resolution of 0.1 as the step interval and the score having the largest successful fraction among the various options as the step interval was taken.Denote by (\text{NMI}_{\text{cell}}) the NMI score for cell type matching; (\text{NMI}_{\text{cell}}) lies between 0 and 1 and a high score indicates more relevant similarity of cluster assignments to the real cell type.

为了衡量真实细胞类型注释与从整合细胞嵌入生成的 Louvain 聚类标签之间的对齐程度，我们计算了归一化互信息（NMI）指标。在 0.1 到 2 的分辨率谱上进行了 Louvain 聚类，步长间隔为 0.1，并选择了这些配置中表现最佳的分数进行分析。对应于细胞类型匹配的 NMI 分数表示为\(\text{NMI}_{\text{cell}}\)；其范围在 0 到 1 之间，数值越高表示聚类分配与真实细胞类型身份之间的对应关系越强。

我们计算了互信息度量——归一化互信息（NMI），用于比较真实细胞类型标注与使用 Louvain 聚类标签生成的集成细胞嵌入标签之间的匹配。Louvain 聚类在 0.1 到 2 的分辨率谱上执行，步长分辨率为 0.1，以步长间隔为步长间隔，并选择在各个选项中具有最大成功分数的分数作为步长间隔。用（\text{NMI}_{\text{cell}}）表示细胞类型匹配的 NMI 分数；（\text{NMI}_{\text{cell}}）介于 0 和 1 之间，高分表示聚类分配与真实细胞类型的相关性更高。

1.1.3备份区：
The silhouette width quantifies the balance between a cell’s average proximity to fellow members of its cluster and its distance to the closest external cluster. By computing the mean of these individual silhouette widths across all cells in the dataset, we obtain the average silhouette width (ASW) score. This score ranges from -1 to 1: a value of 1 denotes sharply separated, tightly cohesive clusters, while scores between -1 and 0 signal overlapping clusters or incorrect cell assignments.

Definition of silhouette width. The silhouette width gives the balance between the average distance of a cell from all other cells in its cluster and from the closest neighbouring cluster.By computing the mean of these individual silhouette widths across all cells in a dataset, we get the average silhouette width (ASW) score.Score of a cluster ranges from –1 to 1: a score of 1 means sharply separated, very condensed clusters, and a score between –1 and 0 means overlapping clusters or wrongly assinged cells.
轮廓宽度量化了细胞对其簇内其他成员的平均邻近性与到最近外部簇的距离之间的平衡。通过对数据集中所有细胞的单个轮廓宽度计算平均值，我们得到平均轮廓宽度（ASW）得分。该得分范围在-1 到 1 之间：1 的值表示分离清晰、紧密凝聚的簇，而-1 到 0 之间的得分则表示重叠的簇或错误的细胞分配。

轮廓宽度定义。轮廓宽度给出了一个细胞与其所在簇中所有其他细胞的平均距离与最近相邻簇的平均距离之间的平衡。通过对数据集中所有细胞的单个轮廓宽度进行计算，我们得到平均轮廓宽度（ASW）得分。簇的得分范围在-1 到 1 之间：得分为 1 表示簇之间分离清晰，非常紧凑；得分在-1 到 0 之间表示簇重叠或细胞分配错误。

To assess the quality of cell type clustering, we calculate an ASW score tied to cell type labels—designated as \(\text{ASW}_{\text{cell}}\). This metric is computed using the formula:

Cell type clustering quality can be tested by calculating an ASW score related to cell type label (let us denote (\text{ASW}_{\text{cell}})). This is calculated by:
为了衡量细胞类型聚类的质量，计算与细胞类型标签相关的 ASW 分数，记为 \(\text{ASW}_{\text{cell}}\)。该指标的计算公式如下：
通过计算与细胞类型标签相关的 ASW 分数（我们将其表示为（ASW_{\text{cell}}）），可以测试细胞类型聚类质量。这是通过以下方式计算的：

here，c...

When evaluating batch mixing performance, we derive an ASW score using batch labels and modify it by subtracting the absolute value of the batch-based ASW from 1; this adjusted metric is noted as \(\text{ASW}_{\text{batch}}\). Its calculation follows:

When we assess batch mixing performance, we compute an ASW score based on the batch labels, and we adjust it by subtracting the absolute value of batch ASW from 1, and this adjusted score is denoted as (\text{ASW}_{\text{batch}}), and its computation is:
使用批次标签导出的ASW分数评估批次混合性能，并进行修正，该修正后的指标记为 \(\text{ASW}_{\text{batch}}\)，修正方法如下：

在评估批量混合性能时，我们基于批量标签计算一个 ASW 分数，并通过从 1 中减去批量 ASW 的绝对值来调整该分数，这个调整后的分数记作（\text{ASW}_{\text{batch}}），其计算公式为：

Both \(\text{ASW}_{\text{cell}}\) and \(\text{ASW}_{\text{batch}}\) span 0 to 1: higher scores in these metrics indicate stronger performance, whether in accurate cell type clustering or effective batch mixing.

Both (\text{ASW}_{\text{cell}}) and (\text{ASW}_{\text{batch}}) span from 0 to 1: bigger the scores are for both metrics, better the performances are, whichever it is in more accurate cell type clustering, or better batch mixing.
\(\text{ASW}_{\text{cell}}\) 和 \(\text{ASW}_{\text{batch}}\) 均为 0 到 1 之间的数值：这些指标中的得分越高，表明性能越强。
(\text{ASW}_{\text{cell}}) 和 (\text{ASW}_{\text{batch}}) 都从 0 到 1 范围内变化：这两个指标得分越高，性能越好，无论是更准确的细胞类型聚类，还是更好的批次混合。

1.1.4
The composite metric \(\text{AvgBIO}\) acts as an aggregated evaluation measure, computed as the average of three key biological consistency metrics (used to assess cell clustering performance):
The metric (\text{AvgBIO}) is an aggregated evaluation metric and can be computed as the average of three important biological consistency measures (cell clustering evaluation metrics):

复合指标 \(\text{AvgBIO}\) 作为一种聚合评估度量，计算为三个关键生物学一致性指标（用于评估细胞聚类性能）的平均值

度量指标（\text{AvgBIO}）是一个聚合型评估指标，可以计算为三个重要的生物学一致性度量指标（细胞聚类评估指标）的平均值：

1.1.5. 第二大段没怎么改
Batch effect correction is a critical data processing step in single-cell omics analysis, designed to mitigate systematic technical variations across datasets from distinct experimental batches. This procedure preserves meaningful biological differences, reduces non-biological technical biases, and thereby improves the reliability of subsequent clustering and cell annotation analyses.

Batch effect correction is an essential data preprocessing step for single-cell omics data analysis, to remove systematic technical variation within datasets from different experimental batches.Steps that preserve meaningful biological differences, remove non-biological technical biases and ultimately improve the trustworthiness of any subsequent clustering and cell annotation analysis.
批次效应校正是单细胞组学分析中一个关键的数据处理步骤，旨在减轻来自不同实验批次的来自不同实验批次的数据集之间的系统技术变异。该程序保留了有意义的生物学差异，减少了非生物学的技术偏差，从而提高了后续聚类和细胞注释分析的可靠性。

批次效应校正是单细胞组学数据分析中一个重要的数据预处理步骤，旨在消除来自不同实验批次的样本集中系统性技术变异。该步骤能够保留有意义的生物学差异，去除非生物学的技术偏差，并最终提高后续聚类和细胞注释分析的可靠性。

where Isolated labels is an indicator measuring the separation degree of distinct cell type populations in the batch-corrected dataset.KMeans NMI is the normalized mutual information between KMeans clustering results (of corrected data) and ground-truth cell type labels, reflecting their consistency.KMeans ARI is the adjusted Rand index between KMeans cluster labels and ground-truth cell type annotations, assessing the similarity between clustering outcomes and biological cell types.Silhouette label is a cell-type-specific silhouette coefficient that quantifies the cohesion of samples within the same cell type and the separation between different cell types in the corrected dataset.cLISI is the cell-type label integration score, which measures the mixing extent of cells of the same type across different batches in the corrected dataset.

where Isolated labels is an indicator for separation degree of cell type populations of different labels in the batch-corrected data.KMeans NMI is the normalised mutual information between KMeans clustering results (of corrected data) and ground-truth cell type labels. Consistency of the two is quantified by this metric.KMeans ARI is the adjusted Rand index between KMeans clustering labels and the ground-truth cell type annotations, between the clustering results and biological cell types.Silhouette label. This is the cell-type-specific silhouette coefficient for cohesion among the samples from the same cell type and separation between different cell types in the corrected data.clisiis cell-type label integration score, which is the cell-type mixing extent of cells of the same type in the different batches in the corrected data.

其中，Isolated labels 是一个指标，用于衡量批量校正数据集中不同细胞类型群体之间的分离程度。KMeans NMI 是校正数据集的 KMeans 聚类结果与真实细胞类型标签之间的归一化互信息，反映了它们的一致性。KMeans ARI 是 KMeans 聚类标签与真实细胞类型注释之间的调整兰德指数，用于评估聚类结果与生物细胞类型之间的相似性。Silhouette label 是一个细胞类型特定的轮廓系数，用于量化校正数据集中同一细胞类型内样本的凝聚性以及不同细胞类型之间的分离度。cLISI 是细胞类型标签整合分数，用于衡量校正数据集中不同批次中相同类型细胞的混合程度。

其中，孤立标签是批次校正数据中不同标签细胞类型群体分离程度的指标。KMeans NMI 是校正数据 KMeans 聚类结果与真实细胞类型标签之间的归一化互信息。这两个结果的一致性通过该指标量化。KMeans ARI 是 KMeans 聚类标签与真实细胞类型注释之间的调整兰德指数，以及聚类结果与生物细胞类型之间的调整兰德指数。轮廓标签。这是校正数据中相同细胞类型样本间凝聚性和不同细胞类型间分离性的细胞类型特定轮廓系数。clisiis 细胞类型标签整合分数，即校正数据中不同批次中相同类型细胞的混合程度。


1.1.6
AvgBatch is an aggregated metric for single-cell omics batch correction performance, combining Silhouette batch, Graph connectivity, and PCR comparison (higher values indicate better batch correction).
AvgBatch is an aggregate metric for single-cell omics batch correction performance, combining Silhouette batch, Graph connectivity and PCR comparison, with higher values representing better batch correction.

AvgBatch 是单细胞组学批次校正性能的综合指标，结合了 Silhouette 批次、图连通性和 PCR 比较（值越高表示批次校正效果越好）。

AvgBatch 是一种用于单细胞组学批量校正性能的聚合指标，结合了轮廓批量、图连通性和 PCR 对比，数值越高表示批量校正效果越好。


where Silhouette batch is a metric that quantifies the separation level between samples from different batches in the batch-corrected single-cell omics dataset.Graph connectivity is an indicator that assesses the connectivity level of samples from distinct batches in the graph structure constructed from batch-corrected data.PCR comparison is a metric that evaluates the reduction of batch-related biases by comparing principal component characteristics before and after batch effect correction.

where Silhouette batch is a measure of the separation level between samples from different batches in the batch-corrected single-cell omics dataset.Graph connectivity is an indicator of the connectivity level of samples from different batches in a graph generated from the batch-corrected data.PCR comparison is a metric that evaluates the reduction of batch biases by comparing the principal component characteristics before and after batch effect correction.


其中，Silhouette batch 指标用于量化批次校正后的单细胞组学数据集中不同批次样本之间的分离程度。Graph connectivity 指标用于评估由批次校正数据构建的图结构中不同批次样本的连接程度。PCR comparison 指标通过比较批次效应校正前后主成分的特征来评估批次相关偏差的减少情况。

轮廓系数（Silhouette batch）是衡量批次校正单细胞组学数据集中不同批次样本分离程度的一个指标。图连通性（Graph connectivity）是衡量批次校正数据生成的图中不同批次样本连通程度的一个指标。PCR 比较（PCR comparison）是一种通过比较批次效应校正前后的主成分特征来评估批次偏差减少程度的指标。


1.2.1 
Model performance in cell-type annotation was assessed by comparing predicted results with true labels, with Accuracy serving as a core metric for overall classification correctness. It quantifies the proportion of samples correctly assigned to their true cell-type classes. For each cell type i, let \(\text{Correct}_i\) represent the number of samples correctly classified into class i; the Accuracy is calculated as:

Model performance in cell-type annotation was also evaluated by comparing predicted results with the true labels, accuracy being the major measurement for global classification correctness. Accuracy is measured by how many samples are classified into true cell-type classes.For each cell type i, let (\text{Correct}_i) be the number of samples that are correctly allocated to the cell type class i. One computes: Accuracy =
在细胞类型注释中，模型性能通过将预测结果与真实标签进行比较进行评估，准确率（Accuracy）作为整体分类正确性的核心指标。它量化了正确分配到其真实细胞类型类别的样本比例。对于每个细胞类型 i，令 Correct_i 表示正确分类到类别 i 的样本数量；准确率的计算公式为：

在细胞类型注释中，模型性能也通过将预测结果与真实标签进行比较进行了评估，准确率是全球分类正确性的主要衡量标准。准确率是通过多少样本被正确分类到真实细胞类型类别来衡量的。对于每个细胞类型 i，令（Correct_i）表示被正确分配到细胞类型类别 i 的样本数量。计算公式为：Accuracy =


1.2.2
Model performance in cell-type annotation was evaluated by contrasting predicted cell-type assignments with ground-truth labels, with the F1 score adopted as the core metric to quantify classification quality. For each individual cell type, the F1 score reflects the trade-off between identifying true class members and ensuring the correctness of predicted class members, thus balancing precision and recall. It is defined as the harmonic mean of precision and recall for the class:

Model performance in cell-type annotation was evaluated by comparing predicted cell-type assignments against the ground-truth labels, and the F1 score used as a metric for classification accuracy.For each individual cell type, the F1 score summarizes the trade-off between the number of true class members detected and the number of true class members for predicted class members detected, summarizing precision and recall. The F1 score for the class is: harmonic mean of the precision and recall for the class
通过将预测的细胞类型分配与真实标签进行对比，评估了模型在细胞类型标注方面的性能，并采用 F1 分数作为量化分类质量的核心指标。对于每种细胞类型，F1 分数反映了识别真实类别成员和确保预测类别成员正确性之间的权衡，从而平衡了精确率和召回率。它被定义为该类别精确率和召回率的调和平均值：

在细胞类型注释中，模型性能通过将预测的细胞类型分配与真实标签进行比较进行评估，并使用 F1 分数作为分类准确性的指标。对于每个单个细胞类型，F1 分数总结了检测到的真实类别成员数与预测类别成员中检测到的真实类别成员数之间的权衡，概括了精确度和召回率。该类别的 F1 分数是类别精确度和召回率的调和平均值。


where \(F1_i\) is the F1 score for the i-th cell type, \(\text{Precision}_i\) represents the precision (proportion of correctly predicted samples among all predicted members of class i), and \(\text{Recall}_i\) denotes the recall (proportion of correctly predicted samples among all true members of class i). To address class imbalances (common in cell-type datasets), the macro F1 score is computed by averaging these per-class F1 scores across all n cell types:

where (F1_i) is the F1 score of the i-th cell type, (\text{Precision}_i) represents the precision (predicted correctly cells in total predicted cells from the class i), and (\text{Recall}_i) represents the recall (predicted correctly cells in total true cells from the class i).For imbalanced classes (common in cell-type datasets), the macro F1 score is calculated by averaging the F1 scores by class across all n cell types:
其中，\(F1_i\) 表示第 i 个细胞类型的 F1 分数，\(\text{Precision}_i\) 表示精确率（在所有预测为 i 类的样本中，正确预测的样本所占的比例），\(\text{Recall}_i\) 表示召回率（在所有真实属于 i 类的样本中，正确预测的样本所占的比例）。为了解决类别不平衡问题（在细胞类型数据集中很常见），宏 F1 分数是通过对所有 n 个细胞类型的每个类别的 F1 分数取平均值来计算的：

其中，(F1_i) 表示第 i 个细胞类型的 F1 分数，(Precision_i) 表示精确率（类别 i 中正确预测的细胞数占所有预测细胞数的比例），(Recall_i) 表示召回率（类别 i 中正确预测的细胞数占所有真实细胞数的比例）。对于类别不平衡的情况（在细胞类型数据集中很常见），宏观 F1 分数是通过对所有 n 个细胞类型的 F1 分数取平均值来计算的：


1.3.1
R@K is a core metric for retrieval/sorting task evaluation, quantifying the coverage of ground-truth relevant items within the top-K ranked results , characterizing the model’s high-ranked result recall capability.

A core metric for evaluation of retrieval/sorting tasks is R@K, which indicates the coverage of ground-truth relevant items in the top-K ranked returned items , meaning the capability of model high-ranked result recall.
R@K 是检索/排序任务评估的核心指标，它量化了排名前 K 的结果中真实相关项目的覆盖率，表征了模型对高排名结果的召回能力。

评估检索/排序任务的核心指标是 R@K，它表示排名前 K 的返回项中真实相关项的覆盖率，这意味着模型召回高排名结果的能力。


where \(\text{Relevant}_{\text{top}K}\) is the number of ground-truth relevant items in the top-K results, and \(\text{Relevant}_{\text{total}}\) denotes the total ground-truth relevant items for the query.For benchmark assessment across Q queries, the mean R@K is calculated as:
where (\text{Relevant}_{\text{top}K}) is the number of ground truth relevant items among the top-K results, and (\text{Relevant}_{\text{total}}) is the number of ground truth relevant items for each query for all benchmark assessment across Q queries, then we calculate mean R@K as:

其中，\(\text{Relevant}_{\text{top}K}\) 表示前 K 个结果中真实相关项的数量。\(\text{Relevant}_{\text{total}}\) 表示查询的真实相关项总数。对于 Q 个查询的基准评估，平均 R@K 计算如下：

其中，(\text{Relevant}_{\text{top}K}) 表示在 Top-K 结果中真实相关的项目数量，而 (\text{Relevant}_{\text{total}}) 表示在所有基准评估中，针对每个查询在 Q 个查询中的真实相关项目总数，然后我们计算平均 R@K 值为：


如何划分边界和对应cell，只需要把该patch的边界算出来，然后细胞在这个边界里的就算进去，然后和细胞的坐标作对比，这样就可以判断细胞在不在这个patch里了


把掩码跑完，论文再次过一遍，修修补补，算法继续往后写，机网继续看，面向ai也要看